---
title: "CyberBullyImportCensusData"
author: "Bridger M. Moreland"
date: '2022-04-23'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Environment Setup

install.packages(c("tidyverse", "tidycensus", "tigris", "sf", "censusapi", "curl", "httr"))

PayloadPackages <- rlang::quos(tidyverse, tidycensus, tigris, sf, censusapi, curl, httr)

invisible(lapply(lapply(PayloadPackages, rlang::quo_name),
  library,
  character.only = TRUE
))

# install.packages("dplyr")
library(dplyr) #tools for working with data frames

library(forcats)

library(ggplot2) #graphing library

# install.packages("ggforce")
library(ggforce)

library(readr)

library(reshape2)

library(data.table) #Read in our CSV file faster than read or readr

# # install.packages("devtools")
library(devtools) #Tools to Make Developing R Packages Easier

# # devtools::install_github("crsh/papaja")
library(papaja) #Works with .bib files to generate APA formats

# devtools::install_github("crsh/citr")
library(citr)

# set_config(
# use_proxy(url="", port="")
# )
set_config(config(ssl_verifypeer = 0L))
set_config(use_proxy(url="10.3.100.207",port=8080))

Sys.setenv(no_proxy="*")

options(internet.info=0)

options(download.file.method="curl")
options(download.file.extra = paste0("--noproxy ", "https://api.census.gov"))
handle_reset("https://api.census.gov/data/2019/cps/internet/nov")

curl::handle_setopt:
options(timeout=300)

curl_version()
ie_proxy_info()

h <- new_handle(proxy = "http://8.8.8.8:8080", verbose = TRUE)
req <- curl_fetch_memory("https://httpbin.org/get", handle = h)

Sys.setenv(ALL_PROXY = "http://8.8.8.8:8080")
req <- curl_fetch_memory("https://httpbin.org/get")

# Add census API key to .Renviron
Sys.setenv(CENSUS_KEY="68960b90025550aad3ec8b60d4918b43cbd44705")
# Reload .Renviron
readRenviron("~/.Renviron")
# Check to see that the expected key is output in your R console
Sys.getenv("CENSUS_KEY")

#Load 2019 CPS Computer & Internet Usage Supplemental

#dfCPSSupplemental <- fread("https://www2.census.gov/programs-surveys/cps/datasets/2019/supp/nov19pub.csv")

# df2019CPSComputerSupplement <- httr::GET("https://api.census.gov/data/2019/cps/internet/nov?get=HRHHID,HRYEAR4,HETENURE,HEHOUSUT,HRNUMHOU,GEREG,GEDIV, PESEX,PEEDUCA,PTDTRACE,PRPERTYP,PEMJOT,PRMJIND1,PENLFACT,PRNLFSCH,PESCHLVL,HECBULLY,HEFAMINC&key=68960b90025550aad3ec8b60d4918b43cbd44705", config = httr::config(connecttimeout = 300))

# df <- getCensus(name = "acs/acs5", vintage = 2016,
# + 	vars = c("B01001_001E", "NAME", "B01002_001E", "B19013_001E"),
# + 	region = "tract:*", regionin = "state:06")

apis <- listCensusApis()
View(apis)


df2019CPSComputerSupplement <- getCensus( 
                name = "cps/internet/nov", 
                vintage = 2019,
                vars = c("HRHHID", "HRYEAR4", "HETENURE", "HEHOUSUT", "HRNUMHOU", "GEREG", "PESEX", "PEEDUCA", "PTDTRACE", "PRPERTYP", "PEMJOT", "PRMJIND1", "PENLFACT", "PRNLFSCH", "PESCHLVL", "HECBULLY", "HEFAMINC"))

rm(df2019CPSComputerSupplement)

```